<!-- views/home-user.handlebars -->
{{> navbar-after-login }}
<div class="row justify-content-between no-gutters">
    {{> drawer }}
    <div class="col-12 col-md-9">
        <div class="card">
            <div class="card-header">Application</div>

            <div class="card-body">
                <div class="accordion" id="accordionExample">
                    {{#each application}}
                    <div class="accordion-item">
                        <div class="accordion-header pb-2 pt-2 pl-2 border border-dark">
                            <span
                                class="bg-light border border-none d-flex justify-content-between px-2 collapsed w-100 text-left"
                                type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{@index}}"
                                aria-expanded="false" aria-controls="collapse{{@index}}"
                                style="z-index: -1 !important;">
                                <div>
                                    <span class="staffName"> </span>
                                    <span class="down-arrow ml-3 position-relative" style="top: -5px"> </span>
                                </div>
                                <form action="edit-application/{{this.ID}}" method="post" class="d-inline">
                                    <input value="" name="status" style="visibility: hidden; width: 10px !important;">
                                    <button type="button" onclick="submitForm(event, 'auto')"
                                        style="z-index: 999 !important;" class="btn btn-sm btn-light text-danger"
                                        class="btn btn-sm btn-light text-danger" type="submit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" class="bi bi-arrow-repeat" viewBox="0 0 16 16"
                                            onclick="submitForm(event, 'auto')">
                                            <path
                                                d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z" />
                                            <path fill-rule="evenodd"
                                                d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z" />
                                        </svg>
                                    </button>
                                    <button type="button" onclick="submitForm(event, 'reject') "
                                        style="z-index: 999 !important;" class="btn btn-sm btn-light text-danger"
                                        type="submit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            onclick="submitForm(event, 'auto')" fill="currentColor"
                                            class="bi bi-x-circle" viewBox="0 0 16 16">
                                            <path
                                                d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                            <path
                                                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                                        </svg>
                                    </button>
                                    <button type="button" onclick="submitForm(event, 'accept')"
                                        style="z-index: 999 !important;" class="btn btn-sm btn-light text-danger"
                                        class="btn btn-sm btn-light text-danger" type="submit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            onclick="submitForm(event, 'auto')" fill="currentColor"
                                            class="bi bi-patch-check" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd"
                                                d="M10.354 6.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708 0z" />
                                            <path
                                                d="m10.273 2.513-.921-.944.715-.698.622.637.89-.011a2.89 2.89 0 0 1 2.924 2.924l-.01.89.636.622a2.89 2.89 0 0 1 0 4.134l-.637.622.011.89a2.89 2.89 0 0 1-2.924 2.924l-.89-.01-.622.636a2.89 2.89 0 0 1-4.134 0l-.622-.637-.89.011a2.89 2.89 0 0 1-2.924-2.924l.01-.89-.636-.622a2.89 2.89 0 0 1 0-4.134l.637-.622-.011-.89a2.89 2.89 0 0 1 2.924-2.924l.89.01.622-.636a2.89 2.89 0 0 1 4.134 0l-.715.698a1.89 1.89 0 0 0-2.704 0l-.92.944-1.32-.016a1.89 1.89 0 0 0-1.911 1.912l.016 1.318-.944.921a1.89 1.89 0 0 0 0 2.704l.944.92-.016 1.32a1.89 1.89 0 0 0 1.912 1.911l1.318-.016.921.944a1.89 1.89 0 0 0 2.704 0l.92-.944 1.32.016a1.89 1.89 0 0 0 1.911-1.912l-.016-1.318.944-.921a1.89 1.89 0 0 0 0-2.704l-.944-.92.016-1.32a1.89 1.89 0 0 0-1.912-1.911l-1.318.016z" />
                                        </svg>
                                    </button>
                                </form>
                            </span>
                        </div>

                        <div id="collapse{{@index}}" class="accordion-collapse collapse"
                            aria-labelledby="heading{{@index}}" data-bs-parent="#accordionExample">
                            <div class="accordion-body d-flex flex-column align-items-start justify-content-start">

                                <form action="edit-application/{{this.ID}}" method="post">
                                    {{#each this}}
                                    <span class="list-group-item list-group-item-sm">
                                        {{ @key}} :
                                        {{#if this}}
                                        {{this}}
                                        {{else}}
                                        Not attached so for
                                        {{/if}}
                                    </span>
                                    {{/each}}

                                </form>

                                <form action="assign-judge/{{this.ID}}" method="post">
                                    <div>
                                        <label class="mt-3 "> Choose a judge for the application</label>
                                    </div>
                                    <div>
                                        <select name="judgeName" class="judgeName" class="w-25"
                                            aria-label="Default select example" class="font-italic">
                                        </select>
                                        <br />
                                        <button class="my-1 mb-4 btn btn-primary btn-sm mx-auto rounded-pill "
                                            type="submit" onclick="submitAssign(event)">Submit</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    {{/each}}

                    <script>
                        function submitForm(event, status) {
                            event.preventDefault()
                            event.stopPropagation()
                            let form = event.target.parentElement
                            form.elements[0].setAttribute("value", status)
                            form.submit()
                        }
                        function fetchJudges() {
                            let judges = JSON.parse(decodeURIComponent("{{ judge }}"))
                            let judgeSelects = document.querySelectorAll('.judgeName')
                            for (let judgeSelect of judgeSelects) {
                                for (let judge of judges) {
                                    judgeSelect.innerHTML += `<option value=${judge._id} class="font-italic">${judge.name} </option>`
                                }
                            }
                        }
                        function fetchStaffName() {
                            let staffNames = JSON.parse(decodeURIComponent("{{ staffName }}"))
                            let staffNameDivs = document.querySelectorAll('.staffName')
                            let index = 0
                            for (let staffNameDiv of staffNameDivs) {
                                staffNameDiv.textContent = staffNames[index]
                                staffNameDiv.style.display = "inline"
                                index++

                            }
                        }
                        (function loadData() {
                            fetchStaffName()
                            fetchJudges()
                        })()

                    </script>
                </div>

            </div>

        </div>
    </div>
</div>
</div>